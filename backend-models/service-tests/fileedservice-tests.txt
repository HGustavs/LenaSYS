Fileedservice.php

--------------------------------------------------------------------------------------------------------------------------------------------
Test the user's login (line 203)
--------------------------------------------------------------------------------------------------------------------------------------------

*********
* pre-req:
*********

include_once "../fileedservice.php";

session_start();
$_SESSION['uid'] = 1;

*********
* Call checklogin function:
*********

$result = checklogin();

*********
* Check if function returned true:
*********

if ($result) {
    echo "Test passed.";
} else {
    echo "Test failed.";
}

--------------------------------------------------------------------------------------------------------------------------------------------
Test to get a username from the database (line 16)
--------------------------------------------------------------------------------------------------------------------------------------------

*********
* pre-req:
*********

date_default_timezone_set("Europe/Stockholm");

include_once "../Shared/sessions.php";
include_once "../Shared/basic.php";

pdoConnect();
session_start();

*********
* Start up the session:
*********

if (isset($_SESSION['uid'])) {
    $userid = $_SESSION['uid'];
} else {
    $userid = "1";
}

*********
* Set the user ID in the session:
*********

$query = $pdo->prepare("SELECT username FROM user WHERE uid = :uid");
$query->bindParam(':uid', $userid);
$query->execute();

*********
* Call the function "checklogin()", "getUsername()" and check values:
*********

if (checklogin()) {				
    $username = getUsername();
    if ($username === "expected_username") {
        echo "Test passed!";
    } else {
        echo "Test failed!";
    }
} else {
    echo "Failed to login.";
}

--------------------------------------------------------------------------------------------------------------------------------------------
Test default user ID (line 9)
--------------------------------------------------------------------------------------------------------------------------------------------

*********
* pre-req:
*********

* $_SESSION['uid'] needs to not be set. *

session_start();
$_SESSION['uid'] = null;


*********
* Start up the session:
*********

session_start();

*********
* Do not set the user ID in the session and call the function:
*********

$_SESSION['uid'] = null;
$result = checklogin();

*********
* Check the values of the functions:
*********

if ($result && $_SESSION['uid'] == 1) {
    echo "Test passed.";
} else {
    echo "Test failed.";
}

"For the test to pass, the returning value should be true and the default user ID should be 1."

--------------------------------------------------------------------------------------------------------------------------------------------
Test the user's access to a course (line 39)
--------------------------------------------------------------------------------------------------------------------------------------------

*********
* pre-req:
*********

$cid = 5678;
$userid = 1234;
$expectedResults = [
    'w' => false, // should be false if the user does not have 'w' access level
    'st' => true, // should be true if the user has 'st' access level
    'sv' => true, // should be true if the user has 'sv' access level
];


*********
* Start up the session:
*********

session_start();


*********
* Test access:
*********

foreach ($expectedResults as $accessLevel => $expectedResult) {
    $result = hasAccess($cid, $userid, $accessLevel);
    if ($result !== $expectedResult) {
        echo "The test has failed: hasAccess( $cid, $userid, '$accessLevel') returned " . var_export($result, true) . ", expected " . var_export($expectedResult, true) . PHP_TEST;
        exit(1);
    }
}

echo "The test has passed." . PHP_TEST;

*For the test to pass, the returning value should be false if the user does not have access to the course and true if the user has*

- Test 5: Test getting parameters from a GET request:
	1. Set the values of all the parameters in the GET request.
	2. Call the function.
	3. Check if the values returning is correctly received.
	4. For the test to pass, the values of the parameters received should be the same as the values set in the GET request.

- Test 6: Test DELFILE service with no access:
	1. Start up the session.
	2. Set the user ID in the session.
	3. Call the function with the service set to DELFILE and the user doesn't have access.
	4. Examine if the file is deleted or not.
	5. For the test to pass, the file is not deleted and no error message has been displayed.

- Test 7: Test DELFILE service with access:
	1. Start up the session.
	2. Set the user ID in the session.
	3. Call the function with the service set to DELFILE and the user have access.
	4. Examine if the file is deleted or not.
	5. For the test to pass, the file should be deleted.