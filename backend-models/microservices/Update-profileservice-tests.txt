profileservice.php

--------------------------------------------
Row : 46 Check if it blocks teacher
--------------------------------------------

if(checklogin()) {
	if (isSuperUser($userid)) {
		$status = "teacher" = IS TRUE; 
	} else if ($action === "challenge" || $action === "password") {
		// and fetch the password from the db
		$querystring="SELECT password FROM user WHERE uid=:userid LIMIT 1";	
		$stmt = $pdo->prepare($querystring);
		$stmt->bindParam(':userid', $userid);
		
		// Shall not return any new password changes.



--------------------------------------------------
Row : 46 Check if functions work if student
--------------------------------------------------


if(checklogin()) {
	if (isSuperUser($userid)) {
		$status = "teacher" = IS FALSE;
	} else if ($action === "challenge" || $action === "password") {
		// and fetch the password from the db
		$querystring="SELECT password FROM user WHERE uid=:userid LIMIT 1";	
		$stmt = $pdo->prepare($querystring);
		$stmt->bindParam(':userid', $userid);
		
		if(!$stmt->execute()) {
			$error = $stmt->errorInfo(); 
			$debug = "Error finding user ".$error[2];
		} else {
			$result = $stmt->fetch(PDO::FETCH_OBJ);

console.log(uid)

// Give Kong for Toddler account, as user info, if uid in console=2, its correct.



--------------------------------------------------
Row 62: Check if passwords matches
--------------------------------------------------

if(password_verify($password, $result->password)) { $result = IS FALSE

//Then give error, if error is given, it's working.


------------------------------------------------------------------------
Row 64: Query that selects the user row if it is a superuser or a teacher
------------------------------------------------------------------------


$accessString = "SELECT access FROM user_course WHERE uid=:userid AND access='W' LIMIT 1";
$query = $pdo->prepare($accessString);
$query->bindParam('userid', $userid);				

If access = 'W', teacher, else student.

if(!$query->execute()) {
					$error = $stmt->errorInfo();
					$debug = "Error checking if user is teacher ".$error[2];
				} else {
					if($query->rowCount() > 0) {
						//If a row matches query, the user is a teacher/superuser and cannot change password/security questions
						$status = "teacher";
					} else {

// If teacher, should not be able to change password. 
// Easiest way to test, https://cms.webug.se/root/G2/students/STUDENTNAME/LenaSYS/DuggaSys/profile.php
// And try to log in is as teacher and change password etc.

------------------------------------------------------------------------
Row : Query that selects the user row if it is a superuser or a teacher
------------------------------------------------------------------------


$accessString = "SELECT access FROM user_course WHERE uid=:userid AND access='W' LIMIT 1";
$query = $pdo->prepare($accessString);
$query->bindParam('userid', $userid);



------------------------------------------------------------------------
Row : Query that selects the user row if it is a superuser or a teacher
------------------------------------------------------------------------

if($action == "challenge"){
								//Update challenge question
								$querystringz = "UPDATE user SET securityquestion=:SQ, securityquestionanswer=:answer WHERE uid=:userid";
								$stmt = $pdo->prepare($querystringz);
								$stmt->bindParam(':userid', $userid);
								$stmt->bindParam(':SQ', $question);
								$stmt->bindParam(':answer', $hashedAnswer);

								if(!$stmt->execute()) {
									$error=$stmt->errorInfo(); 
								} else {
									$success = true;
								}
						} else if($action == "password"){
							//Update password
							$passwordquery = "UPDATE user SET password=:PW WHERE uid=:userid";
							$stmt = $pdo->prepare($passwordquery);
							$stmt->bindParam(':userid', $userid);
							$stmt->bindParam(':PW', $hashedPassword);

							if(!$stmt->execute()) {
								$error=$stmt->errorInfo(); 
							} else {
								$success = true;
							}
						}
					}
				}

// Change challange and password, easiest way to test, use browser.
// Test as teacher, and test as student user, check data in database and the messages in browser. 
